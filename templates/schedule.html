{% extends "base.html" %}
{% block title %}Schedule{% endblock %}
{% block head %}
    <script src="{{ url_for('static', filename='app.js') }}" defer></script>
{% endblock %}
{% block content %}
    <div class="container mt-3">
        <h2>Schedule</h2>
        
        <!-- Schedule URL Display -->
        <div class="alert alert-info">
            <p><strong>Share this link with others:</strong></p>
            <div class="input-group">
                <input type="text" class="form-control" readonly value="{{ schedule_url }}" id="schedule-url">
                <button class="btn btn-outline-secondary" type="button" onclick="copyUrl('schedule-url')">Copy</button>
            </div>
        </div>
        
        <!-- User specific URL -->
        <div class="alert alert-success">
            <p><strong>Your personal link:</strong></p>
            <div class="input-group">
                <input type="text" class="form-control" readonly value="{{ user_url }}" id="user-url">
                <button class="btn btn-outline-secondary" type="button" onclick="copyUrl('user-url')">Copy</button>
            </div>
        </div>
        
        <!-- Users who have responded -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>Respondents ({{ users|length }})</h5>
            </div>
            <div class="card-body">
                {% if users %}
                    <ul class="list-group">
                        {% for user in users %}
                            <li class="list-group-item">
                                <a href="{{ url_for('user_page', schedule_id=schedule.id, user_id=user.id) }}">{{ user.name }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No one has responded yet.</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Schedule Grid -->
        <div id="spa-root">
            <div class="schedule-grid" id="schedule-grid"></div>
            <div class="mt-3">
                <a href="{{ url_for('user_page', schedule_id=schedule.id, user_id=user_id) }}" class="btn btn-primary">Go to Your Response</a>
            </div>
        </div>
    </div>
    
    <script>
        // Set these as both window and global variables for compatibility
        window.scheduleId = "{{ schedule.id }}";
        window.userId = "{{ user_id }}";
        scheduleId = "{{ schedule.id }}";
        userId = "{{ user_id }}";
        window.isReadOnly = true;
        isReadOnly = true;
        
        function copyUrl(elementId) {
            var copyText = document.getElementById(elementId);
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(copyText.value);
            alert("URL copied to clipboard!");
        }
        
        // Initialize schedule with read-only mode
        document.addEventListener('DOMContentLoaded', function() {
            // Variables already set above
            fetchScheduleInfo();
        });
    </script>
{% endblock %}
